---
layout: post
title:  "docker笔记一"
date:   2018-05-09 18:00:00
categories: docker
tags: docker
excerpt: docker的相关笔记一
mathjax: true
---

什么是docker:  
咱们可以通过这篇文章了解一下：  
[https://cloud.tencent.com/developer/article/1005172](https://cloud.tencent.com/developer/article/1005172)  
Docker 容器本质上是宿主机上的一个进程。Docker 通过 namespace 实现了资源隔离，通过 cgroups 实现了资源的限制，通过写时复制机制（copy-on-write）实现了高效的文件操作。

  
 安装docker的过程可以参考官网:  
 [https://docs.docker.com/install/#desktop](https://docs.docker.com/install/#desktop)  
 我这边是通过vagrant新建了一个centos7的环境，命令记录如下：  
```
sudo systemctl start docker
sudo service docker.restart
sudo docker image ls
```
更多命令可以直接通过输入docker命令来查看。  

docker run的相关参数:  
```
Usage: docker run [OPTIONS] IMAGE [COMMAND] [ARG...]    
  
  -d, --detach=false         指定容器运行于前台还是后台，默认为false     
  -i, --interactive=false   打开STDIN，用于控制台交互    
  -t, --tty=false            分配tty设备，该可以支持终端登录，默认为false    
  -u, --user=""              指定容器的用户    
  -a, --attach=[]            登录容器（必须是以docker run -d启动的容器）  
  -w, --workdir=""           指定容器的工作目录   
  -c, --cpu-shares=0        设置容器CPU权重，在CPU共享场景使用    
  -e, --env=[]               指定环境变量，容器中可以使用该环境变量    
  -m, --memory=""            指定容器的内存上限    
  -P, --publish-all=false    指定容器暴露的端口    
  -p, --publish=[]           指定容器暴露的端口   
  -h, --hostname=""          指定容器的主机名    
  -v, --volume=[]            给容器挂载存储卷，挂载到容器的某个目录    
  --volumes-from=[]          给容器挂载其他容器上的卷，挂载到容器的某个目录  
  --cap-add=[]               添加权限，权限清单详见：http://linux.die.net/man/7/capabilities    
  --cap-drop=[]              删除权限，权限清单详见：http://linux.die.net/man/7/capabilities    
  --cidfile=""               运行容器后，在指定文件中写入容器PID值，一种典型的监控系统用法    
  --cpuset=""                设置容器可以使用哪些CPU，此参数可以用来容器独占CPU    
  --device=[]                添加主机设备给容器，相当于设备直通    
  --dns=[]                   指定容器的dns服务器    
  --dns-search=[]            指定容器的dns搜索域名，写入到容器的/etc/resolv.conf文件    
  --entrypoint=""            覆盖image的入口点    
  --env-file=[]              指定环境变量文件，文件格式为每行一个环境变量    
  --expose=[]                指定容器暴露的端口，即修改镜像的暴露端口    
  --link=[]                  指定容器间的关联，使用其他容器的IP、env等信息    
  --lxc-conf=[]              指定容器的配置文件，只有在指定--exec-driver=lxc时使用    
  --name=""                  指定容器名字，后续可以通过名字进行容器管理，links特性需要使用名字    
  --net="bridge"             容器网络设置:  
                                bridge 使用docker daemon指定的网桥       
                                host    //容器使用主机的网络    
                                container:NAME_or_ID  >//使用其他容器的网路，共享IP和PORT等网络资源    
                                none 容器使用自己的网络（类似--net=bridge），但是不进行配置   
  --privileged=false         指定容器是否为特权容器，特权容器拥有所有的capabilities    
  --restart="no"             指定容器停止后的重启策略:  
                                no：容器退出时不重启    
                                on-failure：容器故障退出（返回值非零）时重启   
                                always：容器退出时总是重启    
  --rm=false                 指定容器停止后自动删除容器(不支持以docker run -d启动的容器)    
  --sig-proxy=true           设置由代理接受并处理信号，但是SIGCHLD、SIGSTOP和SIGKILL不能被代理 
```


docker search centos # 搜索镜像
docker pull # 获取镜像
docker image # 查看本地镜像
docker rm # 删除镜像
docker ps # 查看容器
docker ps -a
docker ps -l # 查看最后一个容器的信息
docker run -it nginx bash  # 启动镜像
docker run -d -P --name mynginx nginx  #启动容器时用-P（大写）参数，表示让容器随机对应一个宿主机的端口，注意是随机端口
docker run -d -p 90:80 --name mynginx1 nginx #启动容器时用-p(小写)参数，可以指定端口号进行映射。  

如果你是通过run + bash的格式进入容器，可以通过ctrl + p + q #退出命令行。  

在生产环境中，通常用如下这个命令：
docker exe -it CONTAINER_NAME bash # 进入容器，exec进入容器后，用exit退出，不会停止容器运行

docker start CONTAINER_NAME
docker stop CONTAINER_NAME



